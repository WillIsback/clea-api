=== Tests d'index démarrés le 2025-05-03 13:28:04.497343 ===

INFO: 2025-05-03 13:28:04.497771 -- === TEST: Création d'un index vectoriel ===

INFO: 2025-05-03 13:28:04.497852 -- Création d'un document de test: Test création d'index

INFO: 2025-05-03 13:28:05.821557 -- Document créé avec succès: {'document_id': 9, 'chunks': 2, 'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_needed': True}

INFO: 2025-05-03 13:28:05.836896 -- État initial de l'index: {'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': None}

INFO: 2025-05-03 13:28:05.839375 -- État initial des flags d'indexation: {'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_needed': True, 'document_id': 9, 'document_title': "Test création d'index"}

INFO: 2025-05-03 13:28:05.847186 -- État initial du flag d'index: {'status': 'success', 'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'documents_total': 1, 'documents_need_indexing': 1, 'index_exists': False, 'is_indexed': False, 'correction_needed': True, 'correction_applied': False}

INFO: 2025-05-03 13:28:05.847283 -- Création de l'index pour le corpus 18193a7c-cf6b-46ac-a49e-39b92b62fcaa...

INFO: 2025-05-03 13:28:05.894533 -- Résultat de la création: {'status': 'success', 'message': 'Index vectoriel créé pour 2 chunks dans le corpus 18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_type': 'ivfflat', 'lists': 10, 'documents_updated': 1, 'view_name': 'temp_corpus_chunks_18193a7c_cf6b_46ac_a49e_39b92b62fcaa'}

INFO: 2025-05-03 13:28:05.898370 -- État final de l'index: {'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_exists': True, 'config_exists': True, 'is_indexed': True, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}

INFO: 2025-05-03 13:28:05.900255 -- État final des flags d'indexation: {'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_needed': False, 'document_id': 9, 'document_title': "Test création d'index"}

INFO: 2025-05-03 13:28:05.907947 -- État final du flag d'index: {'status': 'success', 'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'documents_total': 1, 'documents_need_indexing': 0, 'index_exists': True, 'is_indexed': True, 'correction_needed': False}

INFO: 2025-05-03 13:28:05.949550 -- État de tous les index: {'status': 'success', 'corpus_count': 9, 'indexes': [{'corpus_id': '40ebe87f-a19d-42fd-b1c0-675d6be8bcdc', 'index_exists': True, 'config_exists': True, 'is_indexed': True, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}, {'corpus_id': '70ed70c3-5c94-4e64-aa83-2fbc9c9d5fc3', 'index_exists': True, 'config_exists': True, 'is_indexed': True, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}, {'corpus_id': 'e653911b-7059-4b8f-b61c-1785e2954364', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': None}, {'corpus_id': 'fbdcf75c-45e3-48e6-be39-474e2131f60f', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': None}, {'corpus_id': '2bbc17e7-1874-4194-8d52-771a9d34bcb0', 'index_exists': True, 'config_exists': True, 'is_indexed': True, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}, {'corpus_id': '7e15c090-e36b-4c73-bca2-eadf18e23bff', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': None}, {'corpus_id': '18193a7c-cf6b-46ac-a49e-39b92b62fcaa', 'index_exists': True, 'config_exists': True, 'is_indexed': True, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}, {'corpus_id': '354532c1-2b2e-4f9e-aea5-e09008e5b8e8', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': None}, {'corpus_id': '1b41b1cc-a9c3-4645-a987-79a1ef7ebaea', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 34, 'indexed_chunks': 34, 'last_indexed': None}]}

INFO: 2025-05-03 13:28:05.949775 -- ✅ Test de création d'index réussi

INFO: 2025-05-03 13:28:05.953083 -- === TEST: Suppression d'un index vectoriel (corpus: 40ebe87f-a19d-42fd-b1c0-675d6be8bcdc) ===

INFO: 2025-05-03 13:28:05.956895 -- État initial de l'index: {'corpus_id': '40ebe87f-a19d-42fd-b1c0-675d6be8bcdc', 'index_exists': True, 'config_exists': True, 'is_indexed': True, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}

INFO: 2025-05-03 13:28:05.956988 -- Suppression de l'index pour le corpus 40ebe87f-a19d-42fd-b1c0-675d6be8bcdc...

INFO: 2025-05-03 13:28:05.965643 -- Résultat de la suppression: {'status': 'success', 'message': 'Index idx_vector_40ebe87f_a19d_42fd_b1c0_675d6be8bcdc et vue temp_corpus_chunks_40ebe87f_a19d_42fd_b1c0_675d6be8bcdc supprimés avec succès'}

INFO: 2025-05-03 13:28:05.969589 -- État après suppression: {'corpus_id': '40ebe87f-a19d-42fd-b1c0-675d6be8bcdc', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}

INFO: 2025-05-03 13:28:05.969714 -- ✅ Test de suppression d'index réussi

INFO: 2025-05-03 13:28:05.970742 -- === TEST: Cycle de vie complet d'un index vectoriel ===

INFO: 2025-05-03 13:28:06.689211 -- Document créé avec corpus_id explicite: {'document_id': 10, 'chunks': 2, 'corpus_id': 'aa2506ce-14ff-458c-a355-963fa87c04bb', 'index_needed': True}

INFO: 2025-05-03 13:28:06.693518 -- État initial: {'corpus_id': 'aa2506ce-14ff-458c-a355-963fa87c04bb', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': None}

INFO: 2025-05-03 13:28:06.695435 -- État initial du flag index_needed: True

INFO: 2025-05-03 13:28:06.745854 -- Résultat de la création: {'status': 'success', 'message': 'Index vectoriel créé pour 2 chunks dans le corpus aa2506ce-14ff-458c-a355-963fa87c04bb', 'index_type': 'ivfflat', 'lists': 10, 'documents_updated': 1, 'view_name': 'temp_corpus_chunks_aa2506ce_14ff_458c_a355_963fa87c04bb'}

INFO: 2025-05-03 13:28:06.747398 -- État du flag index_needed après création: False

INFO: 2025-05-03 13:28:06.761891 -- Résultat de la suppression: {'status': 'success', 'message': 'Index idx_vector_aa2506ce_14ff_458c_a355_963fa87c04bb et vue temp_corpus_chunks_aa2506ce_14ff_458c_a355_963fa87c04bb supprimés avec succès'}

INFO: 2025-05-03 13:28:06.766907 -- État final: {'corpus_id': 'aa2506ce-14ff-458c-a355-963fa87c04bb', 'index_exists': False, 'config_exists': True, 'is_indexed': False, 'index_type': 'ivfflat', 'chunk_count': 2, 'indexed_chunks': 2, 'last_indexed': datetime.date(2025, 5, 3)}

INFO: 2025-05-03 13:28:06.767030 -- ✅ Test du cycle de vie complet réussi

