=== Log des réponses d'endpoint database de la session de test ===

{
  "request": {
    "method": "POST",
    "url": "/database/documents",
    "body": {
      "document": {
        "title": "Document de test (pytest)",
        "theme": "Test",
        "document_type": "TEST",
        "publish_date": "2025-05-02",
        "corpus_id": "347c7c83-86af-4886-a14d-94d150ed788e"
      },
      "chunks": [
        {
          "content": "Premier chunk",
          "hierarchy_level": 1,
          "start_char": 0,
          "end_char": 12
        },
        {
          "content": "Deuxième chunk",
          "hierarchy_level": 1,
          "start_char": 13,
          "end_char": 27
        }
      ]
    }
  },
  "response": {
    "id": 1,
    "title": "Document de test (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "347c7c83-86af-4886-a14d-94d150ed788e",
    "chunkCount": 2,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "POST",
    "url": "/database/documents",
    "body": {
      "document": {
        "title": "Document de test (pytest)",
        "theme": "Test",
        "document_type": "TEST",
        "publish_date": "2025-05-02",
        "corpus_id": "9d4a4eed-c9f1-4f73-ae26-fcd18f3a0e92"
      },
      "chunks": [
        {
          "content": "Premier chunk",
          "hierarchy_level": 1,
          "start_char": 0,
          "end_char": 12
        },
        {
          "content": "Deuxième chunk",
          "hierarchy_level": 1,
          "start_char": 13,
          "end_char": 27
        }
      ]
    }
  },
  "response": {
    "id": 2,
    "title": "Document de test (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "9d4a4eed-c9f1-4f73-ae26-fcd18f3a0e92",
    "chunkCount": 2,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "GET",
    "url": "/database/documents/2",
    "body": null
  },
  "response": {
    "id": 2,
    "title": "Document de test (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "9d4a4eed-c9f1-4f73-ae26-fcd18f3a0e92",
    "chunkCount": 2,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "GET",
    "url": "/database/documents/2",
    "body": null
  },
  "response": [
    {
      "id": 3,
      "documentId": 2,
      "content": "Premier chunk",
      "startChar": 0,
      "endChar": 12,
      "hierarchyLevel": 1,
      "parentChunkId": null
    },
    {
      "id": 4,
      "documentId": 2,
      "content": "Deuxième chunk",
      "startChar": 13,
      "endChar": 27,
      "hierarchyLevel": 1,
      "parentChunkId": null
    }
  ]
}

{
  "request": {
    "method": "POST",
    "url": "/database/documents",
    "body": {
      "document": {
        "title": "Document de test (pytest)",
        "theme": "Test",
        "document_type": "TEST",
        "publish_date": "2025-05-02",
        "corpus_id": "4f402912-8c35-49ae-876f-f3f7dd163f9d"
      },
      "chunks": [
        {
          "content": "Premier chunk",
          "hierarchy_level": 1,
          "start_char": 0,
          "end_char": 12
        },
        {
          "content": "Deuxième chunk",
          "hierarchy_level": 1,
          "start_char": 13,
          "end_char": 27
        }
      ]
    }
  },
  "response": {
    "id": 3,
    "title": "Document de test (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "4f402912-8c35-49ae-876f-f3f7dd163f9d",
    "chunkCount": 2,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "PUT",
    "url": "/database/documents/3",
    "body": {
      "document": {
        "id": 3,
        "title": "Titre modifié (pytest)"
      },
      "newChunks": [
        {
          "content": "Chunk ajouté",
          "hierarchyLevel": 2,
          "startChar": 28,
          "endChar": 40
        }
      ]
    }
  },
  "response": {
    "id": 3,
    "title": "Titre modifié (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "4f402912-8c35-49ae-876f-f3f7dd163f9d",
    "chunkCount": 3,
    "indexNeeded": false
  }
}

{
  "request": {
    "method": "POST",
    "url": "/database/documents",
    "body": {
      "document": {
        "title": "Document de test (pytest)",
        "theme": "Test",
        "document_type": "TEST",
        "publish_date": "2025-05-02",
        "corpus_id": "6f0021a8-7445-4be2-add1-d0f1e600a53f"
      },
      "chunks": [
        {
          "content": "Premier chunk",
          "hierarchy_level": 1,
          "start_char": 0,
          "end_char": 12
        },
        {
          "content": "Deuxième chunk",
          "hierarchy_level": 1,
          "start_char": 13,
          "end_char": 27
        }
      ]
    }
  },
  "response": {
    "id": 4,
    "title": "Document de test (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "6f0021a8-7445-4be2-add1-d0f1e600a53f",
    "chunkCount": 2,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "DELETE",
    "url": "/database/documents/4/chunks",
    "body": {
      "chunk_ids": 8
    }
  },
  "response": {
    "document_id": 4,
    "chunks_deleted": 1,
    "remaining_chunks": 1
  }
}

{
  "request": {
    "method": "POST",
    "url": "/database/documents",
    "body": {
      "document": {
        "title": "Temp doc",
        "theme": "Temp",
        "document_type": "TMP",
        "publish_date": "2025-05-02",
        "corpus_id": "cd3fefe9-7879-433f-9e17-9f4f663742ec"
      },
      "chunks": []
    }
  },
  "response": {
    "id": 5,
    "title": "Temp doc",
    "theme": "Temp",
    "documentType": "TMP",
    "publishDate": "2025-05-02",
    "corpusId": "cd3fefe9-7879-433f-9e17-9f4f663742ec",
    "chunkCount": 0,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "POST",
    "url": "/database/documents",
    "body": {
      "document": {
        "title": "Document de test (pytest)",
        "theme": "Test",
        "document_type": "TEST",
        "publish_date": "2025-05-02",
        "corpus_id": "af99e9fb-19de-41fa-aa13-ece5e1009efd"
      },
      "chunks": [
        {
          "content": "Premier chunk",
          "hierarchy_level": 1,
          "start_char": 0,
          "end_char": 12
        },
        {
          "content": "Deuxième chunk",
          "hierarchy_level": 1,
          "start_char": 13,
          "end_char": 27
        }
      ]
    }
  },
  "response": {
    "id": 6,
    "title": "Document de test (pytest)",
    "theme": "Test",
    "documentType": "TEST",
    "publishDate": "2025-05-02",
    "corpusId": "af99e9fb-19de-41fa-aa13-ece5e1009efd",
    "chunkCount": 2,
    "indexNeeded": true
  }
}

{
  "request": {
    "method": "POST",
    "url": "/database/indexes/af99e9fb-19de-41fa-aa13-ece5e1009efd/create",
    "body": {
      "index_type": "ivfflat",
      "force": true
    }
  },
  "response": {
    "error": "Échec de création de l'index: (psycopg2.errors.FeatureNotSupported) cannot use subquery in index predicate\nLINE 5:                 WHERE id IN (SELECT id FROM tmp_chunk_ids)\n                                 ^\n\n[SQL: \n                CREATE INDEX chunks_embedding_ivfflat_af99e9fb_19de_41fa_aa13_ece5e1009efd\n                ON chunks USING ivfflat (embedding vector_cosine_ops)\n                WITH (lists = 100)\n                WHERE id IN (SELECT id FROM tmp_chunk_ids)\n                ]\n(Background on this error at: https://sqlalche.me/e/20/tw8g)"
  }
}

